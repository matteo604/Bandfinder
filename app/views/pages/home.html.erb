<div class="photo-container text-center">
  <h1>BandFinder</h1>
</div>

<div class="container" data-controller="toggleswitch">
  <h2 class="text-center mt-3">Discover all the bands</h2>

  <div class="switch-container mt-3 d-flex justify-content-center align-items-center" style="gap: 10px;">
      <span class="label-left" data-toggleswitch-target="labelLeft">Musician looking for a band</span>
      <label class="switch">
      <input type="checkbox" data-toggleswitch-target="toggleSwitch" data-action="change->toggleswitch#toggleContent" <%= "checked" if @button_state %>>
          <span class="slider round" data-toggleswitch-target="slider"></span>
      </label>
      <span class="label-right" data-toggleswitch-target="labelRight">Band looking for a musician</span>
      <button class="h-25 btn btn-secondary"
          data-toggleswitch-target="changeViewButton"
          data-action="click->toggleswitch#changeStatus">
          List View
      </button>
  </div>


  <div class="row mt-4">
    <div class="filter-container mb-4">
      <%= form_with url: search_path, method: :get, local: true, class: "d-flex align-items-center w-100" do |form| %>
        <% if @button_state %>
          <%= hidden_field_tag :form_type, "user_search", data: { toggleswitch_target: "formStatus" } %>
        <% else %>
          <%= hidden_field_tag :form_type, "band_search", data: { toggleswitch_target: "formStatus" } %>
        <% end %>

        <!-- Band Form Section -->
        <div data-toggleswitch-target="bandForm" class="d-flex align-items-center <%= "d-none" if @button_state %>" style="gap: 10px;">
          <div class="search-input">
            <input type="text" id="address-filter" name="band_address" placeholder="Search location" class="form-control filter-input">
          </div>
          <div class="search-input">
            <input type="text" id="genre-filter" name="genre" placeholder="Genre" class="form-control filter-input">
          </div>
          <div class="search-input">
            <input type="text" id="instrument-filter" name="searching_for_instruments" placeholder="Looking for..." class="form-control filter-input">
          </div>
          <div class="search-input">
            <button type="submit" class="filter-button btn btn-primary">Search</button>
          </div>
        </div>

        <!-- User Form Section -->
        <div data-toggleswitch-target="userForm" class="d-flex align-items-center <%= "d-none" if !@button_state %>" style="gap: 10px;">
          <%= hidden_field_tag :state, "#{ @button_state ? "on" : "off" }", data: { toggleswitch_target: "status" } %>
          <div class="search-input">
            <input type="text" id="first-name-filter" name="first_name" placeholder="First Name" class="form-control filter-input">
          </div>
          <div class="search-input">
            <input type="text" id="last-name-filter" name="last_name" placeholder="Last Name" class="form-control filter-input">
          </div>
          <div class="search-input">
            <input type="text" id="location-filter" name="address" placeholder="Location" class="form-control filter-input">
          </div>
         <div class="search-input">
          <select id="instrument-filter" name="searching_for_instruments" class="form-control filter-input">
            <option value="" disabled selected>Select an instrument</option>
            <!-- String instruments -->
            <option value="Guitar">Guitar</option>
            <option value="Bass">Bass</option>
            <option value="Violin">Violin</option>
            <option value="Viola">Viola</option>
            <option value="Cello">Cello</option>
            <option value="Double Bass">Double Bass</option>
            <option value="Harp">Harp</option>
            <option value="Mandolin">Mandolin</option>
            <option value="Banjo">Banjo</option>
            <option value="Ukulele">Ukulele</option>

            <!-- Woodwind instruments -->
            <option value="Flute">Flute</option>
            <option value="Clarinet">Clarinet</option>
            <option value="Oboe">Oboe</option>
            <option value="Bassoon">Bassoon</option>
            <option value="Piccolo">Piccolo</option>
            <option value="English Horn">English Horn</option>
            <option value="Saxophone (Alto)">Saxophone (Alto)</option>
            <option value="Saxophone (Tenor)">Saxophone (Tenor)</option>
            <option value="Saxophone (Baritone)">Saxophone (Baritone)</option>
            <option value="Recorder">Recorder</option>
            <option value="Bass Clarinet">Bass Clarinet</option>

            <!-- Brass instruments -->
            <option value="Trumpet">Trumpet</option>
            <option value="Trombone">Trombone</option>
            <option value="French Horn">French Horn</option>
            <option value="Tuba">Tuba</option>
            <option value="Euphonium">Euphonium</option>
            <option value="Cornet">Cornet</option>
            <option value="Baritone Horn">Baritone Horn</option>

            <!-- Percussion instruments -->
            <option value="Drums">Drums</option>
            <option value="Snare Drum">Snare Drum</option>
            <option value="Bass Drum">Bass Drum</option>
            <option value="Cymbals">Cymbals</option>
            <option value="Timpani">Timpani</option>
            <option value="Bongos">Bongos</option>
            <option value="Conga">Conga</option>
            <option value="Djembe">Djembe</option>
            <option value="Marimba">Marimba</option>
            <option value="Xylophone">Xylophone</option>
            <option value="Vibraphone">Vibraphone</option>
            <option value="Glockenspiel">Glockenspiel</option>
            <option value="Tambourine">Tambourine</option>
            <option value="Triangle">Triangle</option>
            <option value="Castanets">Castanets</option>

            <!-- Keyboard instruments -->
            <option value="Piano">Piano</option>
            <option value="Electric Keyboard">Electric Keyboard</option>
            <option value="Synthesizer">Synthesizer</option>
            <option value="Organ">Organ</option>
            <option value="Harpsichord">Harpsichord</option>
            <option value="Accordion">Accordion</option>

            <!-- Electronic instruments -->
            <option value="Electric Guitar">Electric Guitar</option>
            <option value="Electric Bass">Electric Bass</option>
            <option value="Theremin">Theremin</option>
            <option value="Drum Machine">Drum Machine</option>
            <option value="Samplers">Samplers</option>
            <option value="Synthesizer (Analog)">Synthesizer (Analog)</option>
            <option value="Synthesizer (Digital)">Synthesizer (Digital)</option>
            <option value="Modular Synthesizer">Modular Synthesizer</option>

            <!-- Vocal types -->
            <option value="Vocals (Soprano)">Vocals (Soprano)</option>
            <option value="Vocals (Alto)">Vocals (Alto)</option>
            <option value="Vocals (Tenor)">Vocals (Tenor)</option>
            <option value="Vocals (Baritone)">Vocals (Baritone)</option>
            <option value="Vocals (Bass)">Vocals (Bass)</option>

            <!-- World instruments -->
            <option value="Sitar">Sitar</option>
            <option value="Tabla">Tabla</option>
            <option value="Dhol">Dhol</option>
            <option value="Didgeridoo">Didgeridoo</option>
            <option value="Bagpipes">Bagpipes</option>
            <option value="Shakuhachi">Shakuhachi</option>
            <option value="Kalimba">Kalimba</option>
            <option value="Erhu">Erhu</option>
            <option value="Koto">Koto</option>
            <option value="Balalaika">Balalaika</option>
            <option value="Bouzouki">Bouzouki</option>
            <option value="Steel Drum">Steel Drum</option>
            <option value="Pan Flute">Pan Flute</option>
            <option value="Duduk">Duduk</option>
            <option value="Cimbalom">Cimbalom</option>
            <option value="Ocarina">Ocarina</option>
            <option value="Guqin">Guqin</option>

            <!-- Folk instruments -->
            <option value="Hurdy Gurdy">Hurdy Gurdy</option>
            <option value="Jew's Harp">Jew's Harp</option>
            <option value="Zither">Zither</option>
            <option value="Autoharp">Autoharp</option>
            <option value="Hammered Dulcimer">Hammered Dulcimer</option>
            <option value="Mountain Dulcimer">Mountain Dulcimer</option>

            <!-- Miscellaneous -->
            <option value="Kazoo">Kazoo</option>
            <option value="Melodica">Melodica</option>
            <option value="Maracas">Maracas</option>
            <option value="Claves">Claves</option>
            <option value="Cowbell">Cowbell</option>
            <option value="Guiro">Guiro</option>
            <option value="Agogo">Agogo</option>
          </select>
        </div>

          <div class="search-input">
            <select id="status-filter" name="status" class="form-control filter-input">
              <option value="" disabled selected>Select your status</option>
              <option value="solo">Solo</option>
              <option value="searching">Searching for a band</option>
            </select>
          </div>
          <div class="search-input">
            <button type="submit" class="filter-button btn btn-primary">Search</button>
          </div>
        </div>
      <% end %>
    </div>

    <div data-toggleswitch-target="indexArea" class="d-flex flex-wrap d-none">
      <div data-toggleswitch-target="bandIndex" class="container">
        <h2 class="mb-4">Band List</h2>
        <% @bands.each do |band| %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title text-primary"><%= band.title %></h5>
              <p class="card-text"><%= band.description %></p>
            </div>
            <div class="card-footer text-muted">
              <small>Genre: <%= band.genre %></small>
            </div>
          </div>
        <% end %>
      </div>

      <div data-toggleswitch-target="userIndex" class="d-none container">
        <h2 class="mb-4">User List</h2>
       <% @users.each do |user| %>
        <%= link_to user_path(user) do %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title text-primary"><%= user.first_name %> <%= user.last_name %></h5>
              <p class="card-text">
                <strong>Address:</strong> <%= user.address %><br>
                <strong>Instruments:</strong>
                <% instruments = user.instruments
                  begin
                    formatted_instruments = JSON.parse(instruments).map(&:downcase).join(", ")
                  rescue JSON::ParserError
                    formatted_instruments = instruments
                  end %>
                <%= formatted_instruments %>
              </p>
            </div>
          </div>
        <% end %>
      <% end %>

      </div>
    </div>

    <div data-toggleswitch-target="changedArea" class="d-flex flex-wrap">
      <div class="col-8">
        <div class="cards-container">
          <!-- Band Cards -->
          <div data-toggleswitch-target="bandCard" class="card-group <%= "d-none" if @button_state %>">
            <% @bands.each do |band| %>
              <div class="band-card">
                <div class="card-body">
                  <h5><%= band.title %></h5>
                  <p><%= band.genre %></p>
                  <p>Address: <%= band.address %></p>
                </div>
              </div>
            <% end %>
          </div>

          <!-- User Cards -->
          <div data-toggleswitch-target="userCard" class="card-group container <%= "d-none" if !@button_state %>">
            <div class="row w-100">
              <% @users.each do |user| %>
                <div class="col-4 p-4">
                  <%= render partial: "users/user_card", locals: { user: user } %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="col-4" data-toggleswitch-target="myMarker">
        <div style="width: 100%; height: 480px; border-radius: 5px"
          data-controller="map"
          data-toggleswitch-target="mapContainer"
          data-map-usermarkers-value="<%= @user_markers.to_json %>"
          data-map-bandmarkers-value="<%= @band_markers.to_json %>"
          data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
          <button data-action="click->map#toggleMarkers" data-toggleswitch-target="toggleMarkers">
            Toggle Markers
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
